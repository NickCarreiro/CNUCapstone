{% extends "base.html" %}
{% block body_class %}page-groups{% endblock %}
{% block content %}
{% set membership_count = memberships|length %}
{% set invite_count = pending_invites|length %}
{% set owner_count = memberships|selectattr("role", "equalto", "owner")|list|length %}
<section class="card hero-card groups-hero">
  <div class="eyebrow">Groups</div>
  <h1>Group workspaces and invitations</h1>
  <p class="muted">Create shared workspaces, accept invites, and manage memberships.</p>
  <div class="stat-row">
    <div class="stat-chip">
      <div class="stat-number">{{ membership_count }}</div>
      <div class="stat-label">Memberships</div>
    </div>
    <div class="stat-chip">
      <div class="stat-number">{{ invite_count }}</div>
      <div class="stat-label">Pending invites</div>
    </div>
    <div class="stat-chip">
      <div class="stat-number">{{ owner_count }}</div>
      <div class="stat-label">Owner roles</div>
    </div>
  </div>
  <div class="actions">
    <a class="pill" href="/ui/messages">Open messages</a>
  </div>
</section>

{% if error %}
<div class="alert">{{ error }}</div>
{% endif %}
{% if notice %}
<div class="alert admin-notice">{{ notice }}</div>
{% endif %}

<section class="card">
  <div class="card-header">
    <h2>Create group</h2>
  </div>
  <p class="muted">Start a new shared workspace and invite your team.</p>

  <form method="post" action="/ui/groups/create" class="form compact">
    <label>
      <span>New group name</span>
      <input type="text" name="name" placeholder="engineering-team" required />
    </label>
    <button type="submit">Create group</button>
  </form>
</section>

<section class="card">
  <div class="card-header">
    <h2>Your group memberships</h2>
  </div>
  {% if memberships %}
    <div class="table-wrap">
      <table class="table" id="groupsMembershipTable">
        <thead>
          <tr>
            <th>Group</th>
            <th>Role</th>
            <th>Joined</th>
            <th>Open</th>
          </tr>
        </thead>
        <tbody>
          {% for membership in memberships %}
          <tr>
            <td data-label="Group">{{ membership.group.name }}</td>
            <td data-label="Role">{{ membership.role }}</td>
            <td data-label="Joined">{{ membership.joined_at }}</td>
            <td data-label="Open"><a class="pill" href="/ui/groups/{{ membership.group.id }}">Open</a></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="muted">You are not in any groups yet.</p>
  {% endif %}
</section>

<section class="card">
  <div class="card-header">
    <h2>Pending invites</h2>
  </div>
  {% if pending_invites %}
    <div class="table-wrap">
      <table class="table" id="groupsInvitesTable">
        <thead>
          <tr>
            <th>Group</th>
            <th>Invited by</th>
            <th>Created</th>
            <th>Accept</th>
            <th>Decline</th>
          </tr>
        </thead>
        <tbody>
          {% for invite in pending_invites %}
          <tr>
            <td data-label="Group">{{ invite.group.name }}</td>
            <td data-label="Invited by">{{ invite.inviter.username }}</td>
            <td data-label="Created">{{ invite.created_at }}</td>
            <td data-label="Accept">
              <form method="post" action="/ui/groups/invites/{{ invite.id }}/accept" class="inline-form">
                <button type="submit">Accept</button>
              </form>
            </td>
            <td data-label="Decline">
              <form method="post" action="/ui/groups/invites/{{ invite.id }}/decline" class="inline-form">
                <button type="submit" class="danger">Decline</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="muted">No pending invites.</p>
  {% endif %}
</section>

{% endblock %}
